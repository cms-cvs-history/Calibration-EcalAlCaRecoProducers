process recHitsToAlCaPi0RecHitsProcess = 
{

untracked PSet maxEvents = {untracked int32 input = -1}

include "CalibCalorimetry/Configuration/data/Ecal_FrontierConditions.cff"
include "HLTrigger/Configuration/data/rawToDigi/RawToDigi.cff"

// L1 trigger
include "L1Trigger/Configuration/data/L1DummyConfig.cff"
include "L1Trigger/GlobalTrigger/data/gtDigis.cfi"
sequence doL1RawToDigi = { GctRawToDigi & GtRawToDigi & gtDigis}

//
// Calorimeter = Ecal and Hcal
//
include "RecoLocalCalo/Configuration/data/RecoLocalCalo.cff"

//       in doLocalEcal : need to "decouple" ecalDigis from ecalLocalRecoSequence, 
//       because ecalLocalRecoSequence includes the ecalPreshowerRecHit,
//       which appears in several sequences.
sequence doLocalEcal          = {  ecalDigis & ecalPreshowerDigis & ecalLocalRecoSequence }
//

//
// Getting the list of Ecal FEDs
//   uses EcalListOfFedsProducer module in RecoEgamma/EgammaHLTProducers
//
//include "RecoEgamma/EgammaHLTProducers/data/ecalRegionalEgammaFEDs.cfi"

  include "L1TriggerConfig/L1GeometryProducers/data/l1CaloGeometry.cfi"
  include "L1TriggerConfig/L1GeometryProducers/data/l1CaloGeomRecordSource.cff"


 module ecalRegionalEgammaFEDs = EcalListOfFEDSProducer {

   untracked bool debug = true

   untracked bool EGamma = true
   untracked bool Muon   = false
   untracked bool Jets   = false

   untracked bool EM_doIsolated = true
   untracked bool EM_doNonIsolated = true

   untracked double EM_regionEtaMargin = 0.25
   untracked double EM_regionPhiMargin = 0.40

   untracked double Ptmin_iso = 5
   untracked double Ptmin_noniso = 5

   untracked double Ptmax_iso = 65
   untracked double Ptmax_noniso = 65

   untracked InputTag EM_l1TagIsolated = l1extraParticles:Isolated
   untracked InputTag EM_l1TagNonIsolated = l1extraParticles:NonIsolated

   untracked string OutputLabel = ""
 }



//
// Unpacking Digis based on FED lists
//   uses EcalRawToDigiDev module in EventFilter/EcalRawToDigiDev
//
module  ecalRegionalEgammaDigis = ecalEBunpacker from "EventFilter/EcalRawToDigiDev/data/EcalUnpackerData.cfi"
replace ecalRegionalEgammaDigis.InputLabel="rawDataCollector"
replace ecalRegionalEgammaDigis.DoRegional = true
replace ecalRegionalEgammaDigis.FedLabel = "ecalRegionalEgammaFEDs"
//
// From here on simply cloning ecalLocalRecoSequence.cff
//   with updated InputTags
//
# Calo geometry service model
include "Geometry/CaloEventSetup/data/CaloGeometry.cfi"

module  ecalRegionalEgammaWeightUncalibRecHit = ecalWeightUncalibRecHit from "RecoLocalCalo/EcalRecProducers/data/ecalWeightUncalibRecHit.cfi"
replace ecalRegionalEgammaWeightUncalibRecHit.EBdigiCollection = ecalRegionalEgammaDigis:ebDigis
replace ecalRegionalEgammaWeightUncalibRecHit.EEdigiCollection = ecalRegionalEgammaDigis:eeDigis

module  ecalRegionalEgammaRecHit = ecalRecHit from "RecoLocalCalo/EcalRecProducers/data/ecalRecHit.cfi"
replace ecalRegionalEgammaRecHit.EBuncalibRecHitCollection = ecalRegionalEgammaWeightUncalibRecHit:EcalUncalibRecHitsEB
replace ecalRegionalEgammaRecHit.EEuncalibRecHitCollection = ecalRegionalEgammaWeightUncalibRecHit:EcalUncalibRecHitsEE
replace ecalRegionalEgammaRecHit.EBrechitCollection = "EcalRegRecHitsEB"
replace ecalRegionalEgammaRecHit.EErechitCollection = "EcalRegRecHitsEE"
//
// Preshower is unchanged!
//
include "RecoLocalCalo/EcalRecProducers/data/ecalPreshowerRecHit.cfi"

//
// sequence definition
//
sequence ecalRegionalEgammaRecoSequence = { 
  ecalRegionalEgammaFEDs , ecalRegionalEgammaDigis ,  
  ecalRegionalEgammaWeightUncalibRecHit , ecalRegionalEgammaRecHit &
  ecalPreshowerRecHit }

sequence doRegionalEgammaEcal = { ecalPreshowerDigis & ecalRegionalEgammaRecoSequence }



//  include "CalibCalorimetry/EcalTrivialCondModules/data/EcalTrivialCondRetriever.cfi"
 
  include "RecoEcal/EgammaClusterProducers/data/geometryForClustering.cff"
  include "Geometry/CaloEventSetup/data/EcalTrigTowerConstituents.cfi"

  include "Calibration/EcalAlCaRecoProducers/data/alcastreamEcalRegPi0.cff"
  include "Calibration/EcalAlCaRecoProducers/data/alcastreamEcalRegPi0Output.cff"


  source = PoolSource 
  {
    # Number of events program should run
    untracked vstring fileNames = {
#	'file:/home/raid1/litvin_devel/TestFiles/CMSSW_1_7_2/src/qcd_30_50_full_10ev.root'
	'file:/home/raid1/litvin_devel/TestFiles/CMSSW_1_7_2/src/qcd_30_50_full_100ev.root'
    }
  }


  module out = PoolOutputModule
  {
     untracked string fileName = "alCaPi0RegRCT.root" 
     using alcastreamEcalPi0Output
  }

  path pathAlcastreamEcalPi0 = {doRegionalEgammaEcal,seqAlcastreamEcalPi0}
  endpath outpath = { out }
}
