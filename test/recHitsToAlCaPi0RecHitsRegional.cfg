process recHitsToAlCaPi0RecHitsProcess = 
{

untracked PSet maxEvents = {untracked int32 input = -1}

include "CalibCalorimetry/Configuration/data/Ecal_FrontierConditions.cff"
include "HLTrigger/Configuration/data/rawToDigi/RawToDigi.cff"

// L1 trigger
include "L1Trigger/Configuration/data/L1DummyConfig.cff"
include "L1Trigger/GlobalTrigger/data/gtDigis.cfi"
sequence doL1RawToDigi = { GctRawToDigi & GtRawToDigi & gtDigis}

//
// Calorimeter = Ecal and Hcal
//
include "RecoLocalCalo/Configuration/data/RecoLocalCalo.cff"

//       in doLocalEcal : need to "decouple" ecalDigis from ecalLocalRecoSequence, 
//       because ecalLocalRecoSequence includes the ecalPreshowerRecHit,
//       which appears in several sequences.
sequence doLocalEcal          = {  ecalDigis & ecalPreshowerDigis & ecalLocalRecoSequence }
//

//
// Getting the list of Ecal FEDs
//   uses EcalListOfFedsProducer module in RecoEgamma/EgammaHLTProducers
//
include "RecoEgamma/EgammaHLTProducers/data/ecalRegionalEgammaFEDs.cfi"
//
// Unpacking Digis based on FED lists
//   uses EcalRawToDigiDev module in EventFilter/EcalRawToDigiDev
//
module  ecalRegionalEgammaDigis = ecalEBunpacker from "EventFilter/EcalRawToDigiDev/data/EcalUnpackerData.cfi"
replace ecalRegionalEgammaDigis.InputLabel="rawDataCollector"
replace ecalRegionalEgammaDigis.DoRegional = true
replace ecalRegionalEgammaDigis.FedLabel = "ecalRegionalEgammaFEDs"
//
// From here on simply cloning ecalLocalRecoSequence.cff
//   with updated InputTags
//
# Calo geometry service model
include "Geometry/CaloEventSetup/data/CaloGeometry.cfi"

module  ecalRegionalEgammaWeightUncalibRecHit = ecalWeightUncalibRecHit from "RecoLocalCalo/EcalRecProducers/data/ecalWeightUncalibRecHit.cfi"
replace ecalRegionalEgammaWeightUncalibRecHit.EBdigiCollection = ecalRegionalEgammaDigis:ebDigis
replace ecalRegionalEgammaWeightUncalibRecHit.EEdigiCollection = ecalRegionalEgammaDigis:eeDigis

module  ecalRegionalEgammaRecHit = ecalRecHit from "RecoLocalCalo/EcalRecProducers/data/ecalRecHit.cfi"
replace ecalRegionalEgammaRecHit.EBuncalibRecHitCollection = ecalRegionalEgammaWeightUncalibRecHit:EcalUncalibRecHitsEB
replace ecalRegionalEgammaRecHit.EEuncalibRecHitCollection = ecalRegionalEgammaWeightUncalibRecHit:EcalUncalibRecHitsEE
replace ecalRegionalEgammaRecHit.EBrechitCollection = "EcalRegRecHitsEB"
replace ecalRegionalEgammaRecHit.EErechitCollection = "EcalRegRecHitsEE"
//
// Preshower is unchanged!
//
include "RecoLocalCalo/EcalRecProducers/data/ecalPreshowerRecHit.cfi"

//
// sequence definition
//
sequence ecalRegionalEgammaRecoSequence = { 
  ecalRegionalEgammaFEDs , ecalRegionalEgammaDigis ,  
  ecalRegionalEgammaWeightUncalibRecHit , ecalRegionalEgammaRecHit &
  ecalPreshowerRecHit }

sequence doRegionalEgammaEcal = { ecalPreshowerDigis & ecalRegionalEgammaRecoSequence }



//  include "CalibCalorimetry/EcalTrivialCondModules/data/EcalTrivialCondRetriever.cfi"
 
  include "RecoEcal/EgammaClusterProducers/data/geometryForClustering.cff"
  include "Geometry/CaloEventSetup/data/EcalTrigTowerConstituents.cfi"

  include "Calibration/EcalAlCaRecoProducers/data/alcastreamEcalRegPi0.cff"
  include "Calibration/EcalAlCaRecoProducers/data/alcastreamEcalRegPi0Output.cff"


  source = PoolSource 
  {
    # Number of events program should run
    untracked vstring fileNames = {
        'rfio:/castor/cern.ch/cms/store/mc/2007/12/4/RelVal-RelValQCD_Pt_30_50-HLT/0001/20E32757-D4A2-DC11-A553-001617C3B6E8.root',
        'rfio:/castor/cern.ch/cms/store/mc/2007/12/4/RelVal-RelValQCD_Pt_30_50-HLT/0001/28AFBB8B-D3A2-DC11-BBFD-000423D94A20.root',
        'rfio:/castor/cern.ch/cms/store/mc/2007/12/4/RelVal-RelValQCD_Pt_30_50-HLT/0001/386C538B-D3A2-DC11-916F-001617C3B76A.root',
        'rfio:/castor/cern.ch/cms/store/mc/2007/12/4/RelVal-RelValQCD_Pt_30_50-HLT/0001/42CDD089-D3A2-DC11-9EF1-000423D98BC4.root',
        'rfio:/castor/cern.ch/cms/store/mc/2007/12/4/RelVal-RelValQCD_Pt_30_50-HLT/0001/468BEB56-D4A2-DC11-A9B5-001617DBD556.root',
        'rfio:/castor/cern.ch/cms/store/mc/2007/12/4/RelVal-RelValQCD_Pt_30_50-HLT/0001/4CEF6F8C-D3A2-DC11-9ABA-000423D8F63C.root',
        'rfio:/castor/cern.ch/cms/store/mc/2007/12/4/RelVal-RelValQCD_Pt_30_50-HLT/0001/4E04050C-D5A2-DC11-B437-001617C3B706.root',
        'rfio:/castor/cern.ch/cms/store/mc/2007/12/4/RelVal-RelValQCD_Pt_30_50-HLT/0001/5C490D5C-E3A2-DC11-85A6-001617E30E2C.root',
        'rfio:/castor/cern.ch/cms/store/mc/2007/12/4/RelVal-RelValQCD_Pt_30_50-HLT/0001/5C7E0189-D3A2-DC11-ABA3-000423D94AC8.root',
        'rfio:/castor/cern.ch/cms/store/mc/2007/12/4/RelVal-RelValQCD_Pt_30_50-HLT/0001/646C9A58-D4A2-DC11-96AA-000423D98E30.root',
        'rfio:/castor/cern.ch/cms/store/mc/2007/12/4/RelVal-RelValQCD_Pt_30_50-HLT/0001/664F1774-D4A2-DC11-863F-001617C3B782.root',
        'rfio:/castor/cern.ch/cms/store/mc/2007/12/4/RelVal-RelValQCD_Pt_30_50-HLT/0001/666FF755-D4A2-DC11-B950-0016177CA7A0.root',
        'rfio:/castor/cern.ch/cms/store/mc/2007/12/4/RelVal-RelValQCD_Pt_30_50-HLT/0001/8234AA9A-D3A2-DC11-BCBC-001617DBD332.root',
        'rfio:/castor/cern.ch/cms/store/mc/2007/12/4/RelVal-RelValQCD_Pt_30_50-HLT/0001/90B1740C-D5A2-DC11-B4B8-000423D94700.root',
        'rfio:/castor/cern.ch/cms/store/mc/2007/12/4/RelVal-RelValQCD_Pt_30_50-HLT/0001/967AB63D-D4A2-DC11-BB6B-000423D6CA42.root',
        'rfio:/castor/cern.ch/cms/store/mc/2007/12/4/RelVal-RelValQCD_Pt_30_50-HLT/0001/A2BD185A-D4A2-DC11-9B5D-001617C3B778.root',
        'rfio:/castor/cern.ch/cms/store/mc/2007/12/4/RelVal-RelValQCD_Pt_30_50-HLT/0001/C8832755-D4A2-DC11-B5B7-001617C3B76E.root'

    }
  }


  module out = PoolOutputModule
  {
     untracked string fileName = "alCaPi0Reg.root" 
     using alcastreamEcalPi0Output
  }

  path pathAlcastreamEcalPi0 = {doRegionalEgammaEcal,seqAlcastreamEcalPi0}
  endpath outpath = { out }
}
